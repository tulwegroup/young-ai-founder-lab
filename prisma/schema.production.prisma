// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/cli/prisma-schema
//
// This is the PRODUCTION schema for PostgreSQL (Vercel/Neon)
// Rename this file to schema.prisma before deploying to Vercel

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Student profile with adaptive learning settings
model Student {
  id                 String   @id @default(cuid())
  name               String
  age                Int
  currentWeek        Int      @default(1)
  difficultyLevel    String   @default("advanced")
  totalMissionsDone  Int      @default(0)
  totalInventions    Int      @default(0)
  engineeringScore   Int      @default(0)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  
  progress          Progress[]
  inventions        Invention[]
  patentIdeas       PatentIdea[]
  mentorSessions    MentorSession[]
  architectureNotes ArchitectureNote[]
}

model Mission {
  id                      String   @id @default(cuid())
  weekNumber              Int      @unique
  title                   String
  objective               String
  coreBuildProject        String
  stretchGoals            String
  architectureConcepts    String
  terminology             String
  realWorldParallel       String
  advancedChallenge       String?
  teachingChallenge       String
  inventionChallenge      String
  toolRecommendations     String
  legendaryMission        String?
  estimatedHours          Int      @default(5)
  difficulty              String   @default("advanced")
  category                String
  createdAt               DateTime @default(now())
  
  progress Progress[]
}

model Progress {
  id               String   @id @default(cuid())
  studentId        String
  missionId        String
  status           String   @default("locked")
  startedAt        DateTime?
  completedAt      DateTime?
  notes            String?
  buildLink        String?
  reflectionNotes  String?
  selfAssessment   Int?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  student Student @relation(fields: [studentId], references: [id], onDelete: Cascade)
  mission Mission @relation(fields: [missionId], references: [id], onDelete: Cascade)
  
  @@unique([studentId, missionId])
}

model Invention {
  id               String   @id @default(cuid())
  studentId        String
  title            String
  problemSolved    String
  noveltyDesc      String
  architectureDesc String?
  prototypeLink    String?
  status           String   @default("idea")
  patentable       Boolean  @default(false)
  weekCreated      Int
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  student Student @relation(fields: [studentId], references: [id], onDelete: Cascade)
}

model PatentIdea {
  id                 String   @id @default(cuid())
  studentId          String
  inventionId        String?
  title              String
  problemStatement   String
  currentSolutions   String
  newApproach        String
  advantages         String
  stage              Int      @default(1)
  provisionalDraft   String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  
  student Student @relation(fields: [studentId], references: [id], onDelete: Cascade)
}

model MentorSession {
  id           String   @id @default(cuid())
  studentId    String
  messages     String
  context      String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  student Student @relation(fields: [studentId], references: [id], onDelete: Cascade)
}

model ArchitectureNote {
  id               String   @id @default(cuid())
  studentId        String
  missionWeek      Int
  question         String
  answer           String
  createdAt        DateTime @default(now())
  
  student Student @relation(fields: [studentId], references: [id], onDelete: Cascade)
}
